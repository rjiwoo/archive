<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        /*
        then 을 사용하면 코드도 길어지고, 디버깅도 어렵고, 흐름 제어하기도 까다롭다!
        비동기 코드를 동기 코드처럼 작성하고 싶다. (파이썬처럼 그냥 위에서 아래로 흐르게 하고 싶다!)
        그래서 등장한 게 "async" 와 "await"
        
        async
        - 함수 선언부 앞에 작성
        - 함수 내부에서 await 키워드를 사용할 수 있게 해줌 (주된 이유)
        - async가 작성된 함수는 무조건 Promise 객체를 반환

        await
        - Promise 객체를 반환하는 함수 앞에 작성
        - Promise 객체가 완료(Resolve) 될 때까지 코드 실행을 잠시 멈추고, 결과가 나오면 값만 가져와서 반환 
            - 만약, await 앞의 함수가 Promise 객체를 반환하지 않으면 그냥 무시하고 넘어감
        - async 함수로 선언된 곳 안에서만 await를 사용할 수 있음
        */
        
        // [Async/Await 방식: 3번 연속 호출]
    
    //////////////////////////////////////////
    // 99.1 promise.html 파일을 async/await로 개선한 버전 
    function getRandomData() {
        return new Promise((resolve, reject) => {
            const success = Math.random() > 0.5;
            
            setTimeout(() => {
            if (success) {
                resolve("데이터 도착!"); // 성공 -> .then
            } else {
                reject("에러 발생!"); // 실패 -> .catch
            }
            }, 1000);
        });
    }

    async function main() {
        try {
            // 1번째 시도
            const data1 = await getRandomData(); // Wait!
            console.log("1번째 성공:", data1);

            // 2번째 시도
            const data2 = await getRandomData(); // Wait!
            console.log("2번째 성공:", data2);

            // 3번째 시도
            const data3 = await getRandomData(); // Wait!
            console.log("3번째 성공:", data3);
            
            // for (let i = 1; i <= 3; i++) {
            //     console.log(`--- ${i}번째 시도 시작 ---`);
                
            //     const data = await getRandomData(); 
            //     console.log(`${i}번째 성공:`, data);
            // }

        } catch (err) {
            console.log("중간에 실패함:", err);
        }
    }

    // 최상단이기 때문에 await를 작성하지 않아도 되고, 작성해도 됨
    main();  
    </script>
</body>
</html>